"use strict";(self.webpackChunkposeidon_cli=self.webpackChunkposeidon_cli||[]).push([[185],{5185:(Y,_,a)=>{a.r(_),a.d(_,{BankingModule:()=>H});var h=a(6895),f=a(9624),Z=a(574),d=a(433),e=a(1571),k=a(529);let M=(()=>{class i{constructor(t){this.http=t}saveBanking(t){return console.log("service banking front"),this.http.post("http://localhost:3000/banque",t)}findNotMatched(){return this.http.get("http://localhost:3000/banque")}updateBanque(t,n){return this.http.patch("http://localhost:3000/banque/"+t,n)}saveRelationDepense(t){return this.http.post("http://localhost:3000/relation-depense",t)}searchDateOperation(t){return this.http.get("http://localhost:3000/banque/date_operation/"+t)}searchLibelle(t){return this.http.get("http://localhost:3000/banque/libelle/"+t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(k.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var N=a(2772),q=a(8019),b=a(99),A=a(805),T=a(1740),B=a(5593),C=a(3388),S=a(3214),w=a(7604),y=a(1493),x=a(2210);function U(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",20)(1,"h5",21),e._uU(2,"Importation depius la banque"),e.qZA(),e.TgZ(3,"span",22),e._UZ(4,"i",23),e.TgZ(5,"input",24),e.NdJ("keyup.enter",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.search(s))}),e.qZA()()()}}function D(i,l){1&i&&(e.TgZ(0,"tr")(1,"th",25),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"ID "),e._UZ(5,"p-sortIcon",26),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Date d'op\xe9ration "),e._UZ(8,"p-sortIcon",27),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Libell\xe9 de l'op\xe9ration "),e._UZ(11,"p-sortIcon",28),e.qZA(),e.TgZ(12,"th"),e._uU(13,"D\xe9bit "),e._UZ(14,"p-sortIcon",29),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Cr\xe9dit "),e._UZ(17,"p-sortIcon",30),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Solde "),e._UZ(20,"p-sortIcon",31),e.qZA()())}function J(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"tr",32),e.NdJ("click",function(){const o=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.onSelectedRow(o))}),e.TgZ(1,"td",33),e._UZ(2,"p-tableCheckbox"),e.qZA(),e.TgZ(3,"td",33),e._uU(4),e.qZA(),e.TgZ(5,"td",33),e._uU(6),e.ALo(7,"date"),e.qZA(),e.TgZ(8,"td",33),e._uU(9),e.qZA(),e.TgZ(10,"td",33),e._uU(11),e.qZA(),e.TgZ(12,"td",33),e._uU(13),e.qZA(),e.TgZ(14,"td",33),e._uU(15),e.qZA()()}if(2&i){const t=l.$implicit;e.xp6(4),e.hij(" ",t.id_banque," "),e.xp6(2),e.hij(" ",e.xi3(7,6,t.date_operation,"yyyy-MM-dd")," "),e.xp6(3),e.hij(" ",t.libelle," "),e.xp6(2),e.hij(" ",t.debit," "),e.xp6(2),e.hij(" ",t.credit," "),e.xp6(2),e.hij(" ",t.solde," ")}}const j=function(i){return{"background-color":i}},F=function(i){return{"selected-button":i}};function L(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",34)(2,"div",35)(3,"div",36),e._uU(4),e.qZA(),e.TgZ(5,"div",37),e._uU(6),e._UZ(7,"br"),e.TgZ(8,"small",37),e._uU(9),e.qZA()()(),e.TgZ(10,"div",38)(11,"div",36),e._uU(12),e.qZA()(),e.TgZ(13,"div",39)(14,"button",40),e.NdJ("click",function(){const o=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.change_color(o))}),e.qZA()()()()}if(2&i){const t=l.$implicit,n=e.oxw();e.xp6(2),e.Q6J("ngStyle",e.VKq(6,j,n.background_color)),e.xp6(2),e.hij("N\xb0 ",t.numero_facture,""),e.xp6(2),e.hij("",t.description," "),e.xp6(3),e.Oqu(t.statu),e.xp6(3),e.Oqu(t.montant_HT+t.TVA),e.xp6(2),e.Q6J("ngClass",e.VKq(8,F,n.functionSelect(t)))}}function I(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.dialog=!1)}),e.qZA(),e.TgZ(1,"button",42),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.yesClick())}),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("routerLink",t.routerLink)}}const E=function(){return{width:"35%"}},V=[{path:"",component:(()=>{class i{constructor(t,n,s,o){this.bankingService=t,this.depenseService=n,this.recetteService=s,this.datePipe=o,this.searchForm=new d.cw({value:new d.NI("")}),this.banking=[],this.visibleSidebar=!1,this.depense=[],this.recette=[],this.valueToMatch={banque:0,depense:0,ref_lettrage:""},this.newRecette={banque:0,recette:0,ref_lettrage:""},this.one_banking={credit:0,date_operation:null,debit:0,libelle:"",solde:0},this.isSelected=[],this.dialog=!1,this.approv={TVA:0,admin:0,client:"",date_facture:null,date_operation:null,description:"",montant_HT:0,numero_facture:0,statu:"caisse"},this.newDepense={date_operation:null,date_facture:null,type:"",fournisseur:"",description:"",montant_HT:0,statu:"",admin:0,TVA:0,circuit:"",numero_facture:0},this.valueToSearch=[{value:"date op\xe9ration"},{value:"libell\xe9"}]}ngOnInit(){return this.findNotMatched()}onFileChange(t){const n=t.target;if(n.files.length>1)alert("des fichiers multiples ne sont pas autoris\xe9s");else{const s=new FileReader;let o=[];s.onload=r=>{const m=Z.ij(r.target.result,{type:"binary"});let u=Z.P6.sheet_to_json(m.Sheets[m.SheetNames[0]],{header:1});for(let c=1;c<u.length;c++){let p={credit:0,date_operation:null,debit:0,libelle:"",solde:0};p.date_operation=new Date(u[c][0]),p.libelle=u[c][1],p.debit=Number(u[c][2]),p.credit=Number(u[c][3]),p.solde=Number(u[c][4]),o.push(p)}this.bankingService.saveBanking(o).subscribe(c=>{this.findNotMatched()})},s.readAsBinaryString(n.files[0])}}findNotMatched(){return this.bankingService.findNotMatched().subscribe(t=>{this.banking=t})}onSelectedRow(t){this.depense=[],this.isSelected=[],console.log(this.depense),this.selectedRow=t,this.date=new Date(this.selectedRow.date_operation),this.libelle=this.selectedRow.libelle,this.debit=Number(this.selectedRow.debit),this.credit=Number(this.selectedRow.credit),this.visibleSidebar=!0,console.log(this.selectedRow),this.openMatching(),console.log(this.date),0==this.debit&&0!=this.credit?this.selectDepenseForMatching(this.datePipe.transform(this.selectedRow.date_operation,"yyyy-MM-dd")):this.selectRecetteForMatching(this.datePipe.transform(this.selectedRow.date_operation,"yyyy-MM-dd"))}openMatching(){}selectDepenseForMatching(t){return this.depenseService.getByDate(t).subscribe(n=>{this.depense=n,console.log(this.depense)})}selectRecetteForMatching(t){return this.recetteService.getByDate(t).subscribe(n=>{this.depense=n,console.log(this.depense)})}change_color(t){const n=this.isSelected.indexOf(t);-1!==n?this.isSelected.splice(n,1):this.isSelected.push(t)}functionSelect(t){return this.isSelected.includes(t)}callMatchDepense(){let t;this.depenseService.countByRef("B").subscribe(n=>{let s=Number(n);this.recetteService.countByRef("B").subscribe(o=>{let r=Number(o);t="B"+Number(s+r+1),0==this.isSelected.length?this.dialog=!0:this.matchDepense(t)})}),this.findNotMatched()}matchDepense(t){this.isSelected.forEach(n=>{"banque"==n.statu&&(this.valueToMatch.banque=this.selectedRow.id_banque,this.valueToMatch.depense=n.id_depense,this.valueToMatch.ref_lettrage=t,this.bankingService.saveRelationDepense(this.valueToMatch).subscribe(),this.routerLink="/main/banque",console.log("match depense"))}),this.visibleSidebar=!1}callMatchRecette(){let t,n;this.depenseService.countByRef("C").subscribe(s=>{let o=Number(s);this.recetteService.countByRef("C").subscribe(r=>{let g=Number(r);t="C"+(o+g+1),this.depenseService.countByRef("B").subscribe(v=>{let u=Number(v);this.recetteService.countByRef("B").subscribe(c=>{let p=Number(c);n="B"+(u+p+1),this.matchRecette(t,n)})})})}),this.findNotMatched()}matchRecette(t,n){this.isSelected.forEach(s=>{"caisse"==s.statu?(this.newRecette.banque=this.selectedRow.id_banque,this.newRecette.recette=s.id_recette,this.newRecette.ref_lettrage=t,this.recetteService.saveRelationRecette(this.newRecette).subscribe(),console.log("ity zai caisse recette")):"banque"==s.statu&&(this.newRecette.banque=this.selectedRow.id_banque,this.newRecette.recette=s.id_recette,this.newRecette.ref_lettrage=n,this.recetteService.saveRelationRecette(this.newRecette).subscribe(),console.log("ity zao banque recette"))}),this.visibleSidebar=!1,this.routerLink="/main/banque",console.log("match recette")}insertCaisse(t){let n=localStorage.getItem("admin"),s=JSON.parse(n);this.approv.date_operation=new Date(this.selectedRow.date_operation),this.approv.description=this.selectedRow.libelle,this.approv.montant_HT=this.selectedRow.credit,this.approv.admin=Number(s.id),this.approv.statu="caisse",this.newRecette.banque=this.selectedRow.id_banque,this.newRecette.ref_lettrage=t,this.recetteService.postRecette(this.approv).subscribe(),this.recetteService.getLastId().subscribe(o=>{this.newRecette.recette=Number(o),this.recetteService.saveRelationRecette(this.newRecette).subscribe(),this.routerLink="/main/banque",console.log("insert caisse")})}insertBanque(){let t=localStorage.getItem("admin"),n=JSON.parse(t);this.newDepense.admin=Number(n.id),this.newDepense.date_operation=new Date(this.selectedRow.date_operation),this.newDepense.description=this.selectedRow.libelle,this.newDepense.montant_HT=Number(this.selectedRow.credit),this.newDepense.statu="banque",this.depenseService.postDepense(this.newDepense).subscribe()}yesClick(){let t;!0===this.dialog&&this.depenseService.countByRef("C").subscribe(n=>{let s=Number(n);this.recetteService.countByRef("C").subscribe(o=>{let r=Number(o);t="C"+(s+r+1),this.insertBanque(),this.insertCaisse(t)}),this.dialog=!1}),this.visibleSidebar=!1,this.findNotMatched(),console.log("yes"),this.routerLink="/main/banque",console.log("yes valid")}getSearchValue(t){return t.target.value}search(t){var n=this.getSearchValue(t);let s=this.searchForm.get("value").value;console.log(s),"date op\xe9ration"==s?this.bankingService.searchDateOperation(n).subscribe(o=>{this.banking=o}):"libell\xe9"==s&&this.bankingService.searchLibelle(n).subscribe(o=>{this.banking=o,console.log(s)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(M),e.Y36(N.V),e.Y36(q.S),e.Y36(h.uU))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-banking"]],decls:39,vars:18,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],[2,"display","flex","justify-content","flex-end",3,"formGroup"],["optionValue","value","optionLabel","value","formControlName","value",3,"options","ngModel","ngModelChange"],["mode","basic","multiple","false","maxFileSize","1000000",3,"input"],["selectionMode","single",3,"value"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["position","right",1,"layout-config-content",3,"visible","baseZIndex","visibleChange"],[2,"font-weight","normal","text-align","center"],["pButton","","pRipple","","type","button","label","Envoyer",1,"p-button-success","mr-2","mb-2",2,"margin-left","40%",3,"routerLink","click"],[3,"value"],["pTemplate","listItem"],[3,"visible","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],["pTemplate","footer"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"m-0"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Recherche...",1,"w-full","sm:w-auto",3,"keyup.enter"],[2,"width","3rem"],["field","code"],["field","name"],["field","price"],["field","category"],["field","rating"],["field","inventoryStatus"],[3,"click"],[2,"width","14%","min-width","10rem"],[1,"flex","flex-column","md:flex-row","align-items-center","p-3","w-full"],[1,"flex-1","text-center","md:text-left",3,"ngStyle"],[1,"font-bold","text-xl"],[1,"mb-3"],[1,"flex-1","text-center","md:text-left"],[1,"flex","flex-row","md:flex-column","justify-content-between","w-full","md:w-auto","align-items-center","md:align-items-end","mt-5","md:mt-0"],["pButton","","pRipple","","type","button","label","Selectionner",1,"p-button-rounded","p-button-warning","mr-2","mb-2",3,"ngClass","click"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-text",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Yes",1,"p-button-text",3,"routerLink","click"]],template:function(t,n){1&t&&(e.TgZ(0,"h2"),e._uU(1,"Banking"),e.qZA(),e.TgZ(2,"div",0)(3,"div",1)(4,"div",2)(5,"form",3)(6,"p-dropdown",4),e.NdJ("ngModelChange",function(o){return n.selectedValue=o}),e.qZA()(),e.TgZ(7,"p-fileUpload",5),e.NdJ("input",function(o){return n.onFileChange(o)}),e._uU(8," Choose "),e.qZA(),e.TgZ(9,"p-table",6,7),e.YNc(11,U,6,0,"ng-template",8),e.YNc(12,D,21,0,"ng-template",9),e.YNc(13,J,16,9,"ng-template",10),e.qZA()()()(),e.TgZ(14,"p-sidebar",11),e.NdJ("visibleChange",function(o){return n.visibleSidebar=o}),e.TgZ(15,"h3",12),e._uU(16,"BANKING"),e.qZA(),e.TgZ(17,"p")(18,"b"),e._uU(19,"Date d'op\xe9ration"),e.qZA(),e._uU(20),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"p")(23,"b"),e._uU(24,"Libell\xe9 de l'op\xe9ration"),e.qZA(),e._uU(25),e.qZA(),e.TgZ(26,"p")(27,"b"),e._uU(28,"Montant "),e.qZA(),e._uU(29),e.qZA(),e.TgZ(30,"button",13),e.NdJ("click",function(){return 0==n.debit?n.callMatchDepense():n.callMatchRecette()}),e.qZA(),e.TgZ(31,"p-dataView",14),e.YNc(32,L,15,10,"ng-template",15),e.qZA()(),e.TgZ(33,"p-dialog",16),e.NdJ("visibleChange",function(o){return n.dialog=o}),e.TgZ(34,"div",17),e._UZ(35,"i",18),e.TgZ(36,"span"),e._uU(37,"Voulez-vous envoyer ce mouvement en tant qu'approvisionnement dans la caisse?"),e.qZA()(),e.YNc(38,I,2,1,"ng-template",19),e.qZA()),2&t&&(e.xp6(5),e.Q6J("formGroup",n.searchForm),e.xp6(1),e.Q6J("options",n.valueToSearch)("ngModel",n.selectedValue),e.xp6(3),e.Q6J("value",n.banking),e.xp6(5),e.Akn(e.DdM(17,E)),e.Q6J("visible",n.visibleSidebar)("baseZIndex",1e4),e.xp6(6),e.hij(" ",e.xi3(21,14,n.date,"yyyy-MM-dd"),""),e.xp6(5),e.hij(" ",n.libelle,""),e.xp6(4),e.hij(" ",0==n.credit?n.debit:n.credit,""),e.xp6(1),e.Q6J("routerLink",n.routerLink),e.xp6(1),e.Q6J("value",n.depense),e.xp6(2),e.Q6J("visible",n.dialog))},dependencies:[h.mk,h.PC,f.rH,b.iA,A.jx,b.fz,b.UA,b.Mo,T.o,B.Hq,C.p,d._Y,d.JJ,d.JL,d.sg,d.u,S.Y,w.VO,y.V,x.Lt,h.uU],styles:[".selected-row[_ngcontent-%COMP%]{background-color:#80808073}.selected-button[_ngcontent-%COMP%]{background-color:#000;color:#fff}"]}),i})()}];let O=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,f.Bz.forChild(V),f.Bz]}),i})(),H=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[h.uU],imports:[h.ez,O,b.U$,T.j,k.JF,B.hJ,C.O,d.UX,S.l,w.FI,y.S,x.kW]}),i})()}}]);